<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tables Turned</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ═══ CINEMATIC INTRO ═══ -->
  <div id="intro">
    <div class="intro-glow"></div>
    <div id="skip-intro">skip</div>

    <!-- Act I: Void -->
    <section class="act active" id="act-1">
      <div class="act-inner">
        <div class="sigil-intro">&#9674; &#9672; &#9674;</div>
      </div>
    </section>

    <!-- Act II: The Wound -->
    <section class="act" id="act-2">
      <div class="act-inner act-text">
        <p id="w1"></p>
        <p id="w2"></p>
        <p id="w3" class="mt"></p>
        <p id="w4"></p>
        <p id="w5" class="mt accent"></p>
      </div>
    </section>

    <!-- Act III: The Turn -->
    <section class="act" id="act-3">
      <div class="act-inner act-text">
        <p id="t1"></p>
        <p id="t2" class="mt"></p>
        <p id="t3"></p>
        <p id="t4"></p>
        <p id="t5" class="mt accent"></p>
      </div>
    </section>

    <!-- Act IV: Enter -->
    <section class="act" id="act-4">
      <div class="act-inner">
        <div class="sigil-intro instant">&#9674; &#9672; &#9674;</div>
        <h1 class="intro-title">Tables Turned</h1>
        <p class="intro-sub">The Commons Table. Receipts only.</p>
        <button id="enter-btn">Flip the Tables</button>
      </div>
    </section>
  </div>

  <!-- ═══ THE APP ═══ -->
  <div id="app" class="hidden">

    <header>
      <div class="sigil">&#9674; &#9672; &#9674;</div>
      <h1>Tables Turned</h1>
      <p class="subtitle">The Commons Table. Receipts only.</p>
    </header>

    <!-- ═══ WHAT IS THIS? (brief) ═══ -->
    <div class="explainer-brief" id="explainer-brief">
      <p>The public record of medical research exists, is free, and is written in a language designed to exclude you. This tool searches it, translates it into plain English, and cites every claim so you can verify it yourself. <a href="#about-section" id="learn-more-link">Learn how it works.</a></p>
    </div>

    <!-- ═══ STEP 1: ASK ═══ -->
    <div id="input-view">
      <div class="step-label">Step 1 <span class="step-label-text">Ask your question</span></div>

      <div class="field">
        <label for="q">What are you trying to figure out?</label>
        <textarea id="q" rows="2" placeholder="e.g., Does vitamin D supplementation reduce respiratory infections in children?"></textarea>
      </div>

      <div class="field">
        <label for="ctx">
          What decision does this serve?
          <span class="info-tip" data-tip="Your decision context shapes the synthesis. 'Buying supplements tomorrow' produces different emphasis than 'writing a school paper.' The AI uses this to focus on what matters to you.">?</span>
        </label>
        <input type="text" id="ctx" placeholder="e.g., Deciding whether to give my kid supplements before winter">
      </div>

      <div class="field" id="key-field">
        <label for="key">Anthropic API Key</label>
        <p class="hint">Your key stays in your browser and is only sent to Anthropic's API. Nothing passes through our servers. <a href="https://console.anthropic.com/settings/keys" target="_blank">Get a key here.</a></p>
        <input type="password" id="key" placeholder="sk-ant-...">
      </div>

      <!-- Search settings -->
      <details class="search-settings" id="search-settings">
        <summary>Search settings</summary>
        <div class="settings-grid">
          <div class="setting-item">
            <label for="s-depth">Results per query</label>
            <select id="s-depth">
              <option value="5">5 (quick scan)</option>
              <option value="10" selected>10 (standard)</option>
              <option value="25">25 (deep dive)</option>
            </select>
            <span class="setting-note">Applied to each of 3-4 AI-generated search strategies</span>
          </div>
          <div class="setting-item">
            <label for="s-sort">Sort by</label>
            <select id="s-sort">
              <option value="relevance" selected>Most relevant</option>
              <option value="pub_date">Most recent</option>
            </select>
          </div>
        </div>
      </details>

      <!-- Process transparency callout -->
      <div class="process-callout">
        <div class="process-header">What happens when you search</div>
        <ol class="process-steps">
          <li>Your question is sent to <strong>Claude Opus</strong>, which translates it into optimized medical search terms (MeSH headings, boolean operators, synonyms)</li>
          <li>Those terms query <strong>PubMed</strong>, the world's largest biomedical database (37M+ papers, free, public)</li>
          <li>Each paper is translated into <strong>plain language</strong> so you can decide which ones matter</li>
          <li>You choose papers. AI reads the abstracts and writes a <strong>cited brief</strong> you can download</li>
        </ol>
      </div>

      <button id="search-btn" class="btn-primary">Search the Public Record</button>
      <div id="search-status"></div>

      <!-- Manual entry with pedagogical handhold -->
      <details class="manual-entry">
        <summary>I already have PubMed links</summary>
        <div class="manual-explain">
          <p><strong>PubMed</strong> is the world's largest database of medical research, maintained by the U.S. National Library of Medicine. Every published study has a unique PubMed ID (PMID). If you have already found studies you want analyzed, paste their links or IDs below and skip the AI search step.</p>
        </div>
        <div class="field" style="margin-top: 0.75rem;">
          <p class="hint">Paste URLs, PMIDs, or DOIs. One per line.</p>
          <textarea id="links" rows="4" placeholder="https://pubmed.ncbi.nlm.nih.gov/28202713/
28202713
10.1136/bmj.i6583"></textarea>
          <button id="manual-btn" class="btn-secondary" style="margin-top: 0.75rem;">Analyze These Papers</button>
        </div>
      </details>
    </div>

    <!-- ═══ STEP 2: CURATE ═══ -->
    <div id="curate-view" class="hidden">
      <div class="step-label">Step 2 <span class="step-label-text">Choose your papers</span></div>
      <p class="step-desc">We searched PubMed using AI-generated terms. Each paper has been translated into plain language. Check the ones relevant to your question. Uncheck the rest.</p>

      <!-- How we found these -->
      <details class="search-disclosure" id="search-disclosure">
        <summary>How we found these papers</summary>
        <div id="search-terms-display"></div>
        <div class="prompt-peek">
          <details>
            <summary>See the search prompt sent to AI</summary>
            <pre id="search-prompt-display" class="prompt-display"></pre>
          </details>
        </div>
      </details>

      <!-- Search stats -->
      <div class="search-stats" id="search-stats"></div>

      <div class="curate-actions">
        <button id="select-all-btn" class="btn-small">Select all</button>
        <button id="select-none-btn" class="btn-small">Select none</button>
        <span id="curate-count" class="curate-count"></span>
      </div>

      <div id="curate-list"></div>

      <button id="synthesize-btn" class="btn-primary">Read and Synthesize</button>
      <button id="back-to-search" class="btn-back">&#8592; Back to search</button>
    </div>

    <!-- ═══ STEP 3: PROCESSING ═══ -->
    <div id="processing-view" class="hidden">
      <div class="step-label">Step 3 <span class="step-label-text">Reading the record</span></div>
      <div class="processing-sigil">&#9672;</div>
      <div id="proc-status">Preparing synthesis...</div>
      <div id="proc-papers"></div>

      <details class="prompt-peek">
        <summary>See the synthesis prompt</summary>
        <pre id="synth-prompt-display" class="prompt-display"></pre>
      </details>

      <div id="stream-out"></div>
    </div>

    <!-- ═══ STEP 4: RESULTS ═══ -->
    <div id="results-view" class="hidden">
      <div class="step-label">Your Brief</div>
      <div id="brief-out" class="brief-box"></div>

      <details class="prompt-peek" style="margin-bottom: 1rem;">
        <summary>See the prompt that generated this brief</summary>
        <pre id="result-prompt-display" class="prompt-display"></pre>
      </details>

      <div class="provenance-section" id="provenance-section">
        <details>
          <summary>Provenance log</summary>
          <div id="provenance-log" class="provenance-log"></div>
        </details>
      </div>

      <div class="export-row">
        <button class="export-btn primary" id="dl-docx">Download Brief (.docx)</button>
        <button class="export-btn" id="dl-brief">Download Brief (.md)</button>
        <button class="export-btn" id="dl-tablet">Download Tablet (.json)</button>
      </div>
      <button id="again-btn" class="btn-back">&#8592; New question</button>
    </div>

    <!-- ═══ ABOUT & DOCUMENTATION ═══ -->
    <div class="about-section" id="about-section">
      <div class="about-toggle" id="about-toggle">
        <span>About &amp; Documentation</span>
        <span class="toggle-arrow">&#9662;</span>
      </div>
      <div class="about-body hidden" id="about-body">

        <div class="doc-chapter">
          <h2>The Mission</h2>
          <h3>Rome is a pattern, not a place</h3>
          <p>Every era has its gatekeepers. In the ancient world, priests controlled access to scripture. In the medieval world, the Church controlled access to knowledge. In the modern world, journals and institutions control access to research.</p>
          <p>The pattern is always the same: knowledge exists, but ordinary people are told they cannot be trusted with it. That they need interpreters. That the raw material is too complex, too dangerous, too sacred for common hands.</p>
          <p>Tables Turned refuses this premise. The public record is public. PubMed abstracts are free. The question is not access. The question is translation.</p>

          <h3>The information flood</h3>
          <p>The modern crisis is not a lack of information. It is a drowning in it. PubMed alone contains over 37 million citations. No human can read them all. No human needs to. What people need is a way to find the relevant research, understand what it says, and make an informed decision.</p>
          <p>This is not a problem AI solves by replacing human judgment. It is a problem AI solves by being the translator at the table. You bring the question. The public record provides the evidence. AI reads the abstracts and explains what they say in plain language. You decide what to do.</p>

          <h3>Receipts only</h3>
          <p>The core principle is provenance. Every claim in a Tables Turned brief traces back to a specific paper, identified by its PubMed ID (PMID). This is not a suggestion. It is a rule. If a claim cannot be traced to a provided paper, it is marked [UNWITNESSED] and flagged.</p>
          <p>This matters because the history of AI-generated content is a history of hallucination. Models invent citations. They blend findings from different papers. They state conclusions that sound authoritative but have no source. Tables Turned treats this as a moral failure, not a technical limitation. Every claim has receipts, or it is marked as unsupported.</p>
        </div>

        <div class="doc-chapter">
          <h2>How It Works</h2>
          <h3>Step 1: Ask your question</h3>
          <p>Type a plain-English question and the decision it serves. The decision context matters because it shapes what kind of evidence is relevant. "Does melatonin help kids sleep?" is different when the context is "deciding whether to try it tonight" versus "writing a school paper on sleep disorders."</p>

          <h3>Step 2: AI-powered search</h3>
          <p>Your question is sent to Claude Opus, which generates optimized PubMed search terms. This is not simple keyword extraction. The AI understands medical terminology, constructs boolean queries with MeSH headings, and generates multiple strategies (broad to specific) to maximize coverage.</p>
          <p>The search terms are shown to you transparently. You can see exactly what was searched and why. The results are fetched directly from the NCBI E-utilities API, the same public API that powers PubMed itself.</p>
          <p>Each paper is then translated into plain language by AI, so you can understand what it found without reading medical jargon. You review every paper and choose which ones to include. This is your curation step. You decide what enters the synthesis.</p>

          <h3>Step 3: Synthesis</h3>
          <p>The selected papers (abstracts, titles, authors, journals, years) are sent to Claude Opus with strict instructions: separate observation from inference, cite every claim, surface contradictions, write in plain language, state confidence honestly, name what is unknown, never hallucinate.</p>
          <p>The synthesis streams in real-time so you can watch it being written.</p>

          <h3>Step 4: Your brief</h3>
          <p>The finished brief includes: what the papers say (grouped by finding, each cited), what we infer (numbered claims, each sourced), what is unknown (gaps the papers do not address), and confidence (honest assessment with reasoning).</p>
          <p>Download as a formatted Word document (.docx), markdown (.md), or the raw session data (.json).</p>
        </div>

        <div class="doc-chapter">
          <h2>The Prompts</h2>
          <p>Every AI interaction in Tables Turned uses a carefully designed prompt. Here they are in full, so you can see exactly what instructions the AI receives.</p>

          <h3>Search Query Generation</h3>
          <p>When you type your question and press search, this prompt converts your plain English into optimized medical database queries.</p>
          <pre id="doc-prompt-search" class="prompt-display"></pre>

          <h3>Plain-Language Translation</h3>
          <p>After finding papers, this prompt asks the AI to translate each title and abstract into language anyone can understand.</p>
          <pre id="doc-prompt-summary" class="prompt-display"></pre>

          <h3>Synthesis</h3>
          <p>This is the core prompt. It governs how the AI reads the papers and writes your brief. Every rule serves a specific purpose: separating fact from inference, enforcing citations, surfacing disagreement, and preventing hallucination.</p>
          <pre id="doc-prompt-synth" class="prompt-display"></pre>
        </div>

        <div class="doc-chapter">
          <h2>Technical Details</h2>
          <h3>Data sources</h3>
          <p><strong>PubMed / NCBI E-utilities:</strong> All paper metadata and abstracts are fetched from the National Center for Biotechnology Information's public API. This is the same database used by researchers, doctors, and institutions worldwide. It is free, public, and requires no account.</p>

          <h3>AI model</h3>
          <p><strong>Claude Opus by Anthropic:</strong> All AI interactions use Claude Opus, Anthropic's most capable model. You provide your own API key, which means your data is sent directly from your browser to Anthropic's servers. Nothing passes through our servers because we do not have servers. This is a static website.</p>

          <h3>Privacy</h3>
          <p>Your API key is stored in your browser's localStorage. It is never sent anywhere except to Anthropic's API. Your questions, papers, and briefs exist only in your browser. When you close the tab, they are gone unless you downloaded them. We do not track you. We do not have analytics. We do not have a database.</p>

          <h3>Limitations</h3>
          <ul>
            <li><strong>Abstracts only.</strong> Tables Turned reads abstracts, not full papers. Abstracts are free and public. Full papers are often paywalled. This means nuance in the methods or results sections may be missed.</li>
            <li><strong>AI can err.</strong> Despite strict instructions, Claude may occasionally misinterpret an abstract or make an inference that is not fully supported. The PMID citations let you verify every claim yourself.</li>
            <li><strong>Not medical advice.</strong> This tool helps you understand research. It does not replace a doctor. It gives you better questions to ask, not answers to follow blindly.</li>
            <li><strong>English only.</strong> PubMed abstracts are predominantly in English. Research published in other languages may not appear.</li>
          </ul>
        </div>

        <div class="doc-chapter">
          <h2>The Lineage</h2>
          <p>Tables Turned inherits from a long tradition of making knowledge accessible. From the translation of scripture into common tongues, to the creation of public libraries, to the open-access movement in academic publishing, the pattern is always the same: gatekeepers resist, translators persist, and eventually the public record returns to the public.</p>
          <p>This tool is one small table flip in that tradition. It is not a replacement for reading. It is not a shortcut for thinking. It is a translator that sits at the table with you, reads the public record aloud, and makes sure every claim has a receipt.</p>
          <p class="lineage-end">The commons table is set. Pull up a chair.</p>
        </div>

      </div>
    </div>

    <!-- ═══ SETTINGS ═══ -->
    <details id="settings">
      <summary>Settings</summary>
      <div class="settings-inner">
        <div class="field">
          <label for="s-key">API Key</label>
          <input type="password" id="s-key">
        </div>
      </div>
    </details>

    <!-- ═══ FOOTER ═══ -->
    <footer id="site-footer">
      <div class="footer-brand">
        <div class="footer-sigil">&#9674; &#9672; &#9674;</div>
        <div class="footer-title">The Word Against The Flood</div>
      </div>
      <div class="footer-links">
        <a href="mailto:JEThomasPhD@gmail.com">JEThomasPhD@gmail.com</a>
      </div>
      <div class="footer-sig">
        Made using <a href="https://the-companion-dossier.pages.dev/Latent_Dialogic_Space/" target="_blank" rel="noopener">Latent Dialogic Space</a>
      </div>
    </footer>
  </div>

  <script src="js/shoreline.js"></script>
  <script src="js/tablet-press.js"></script>
  <script src="js/synthesis.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
