<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tables Turned</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ═══ CINEMATIC INTRO ═══ -->
  <div id="intro">
    <div id="skip-intro">skip</div>

    <!-- Act I: Void — Confusion -->
    <section class="act active" id="act-1">
      <div class="act-inner">
        <div class="sigil-intro">&#9674; &#9672; &#9674;</div>
      </div>
    </section>

    <!-- Act II: The Wound — Awe -->
    <section class="act" id="act-2">
      <div class="act-inner act-text">
        <p id="w1"></p>
        <p id="w2"></p>
        <p id="w3" class="mt"></p>
        <p id="w4"></p>
        <p id="w5" class="mt gold"></p>
      </div>
    </section>

    <!-- Act III: The Turn — Understanding -->
    <section class="act" id="act-3">
      <div class="act-inner act-text">
        <p id="t1"></p>
        <p id="t2" class="mt"></p>
        <p id="t3"></p>
        <p id="t4"></p>
        <p id="t5" class="mt gold"></p>
      </div>
    </section>

    <!-- Act IV: Enter — Action -->
    <section class="act" id="act-4">
      <div class="act-inner">
        <div class="sigil-intro instant">&#9674; &#9672; &#9674;</div>
        <h1 class="intro-title">Tables Turned</h1>
        <button id="enter-btn">Flip the Tables</button>
      </div>
    </section>
  </div>

  <!-- ═══ THE APP ═══ -->
  <div id="app" class="hidden">

    <header>
      <div class="sigil">&#9674; &#9672; &#9674;</div>
      <h1>Tables Turned</h1>
      <p class="subtitle">The Commons Table. Receipts only.</p>
    </header>

    <!-- Input View -->
    <div id="input-view">
      <div class="field">
        <label for="q">What are you trying to figure out?</label>
        <textarea id="q" rows="2" placeholder="e.g., Does vitamin D supplementation reduce respiratory infections in children?"></textarea>
      </div>

      <div class="field">
        <label for="ctx">What decision does this serve?</label>
        <input type="text" id="ctx" placeholder="e.g., Deciding whether to give my kid supplements before winter">
      </div>

      <div class="field">
        <label>Your PubMed articles</label>
        <p class="hint">Paste URLs, PMIDs, or DOIs. One per line.</p>
        <textarea id="links" rows="6" placeholder="https://pubmed.ncbi.nlm.nih.gov/28202713/
28202713
10.1136/bmj.i6583"></textarea>
      </div>

      <div class="field" id="key-field">
        <label for="key">Anthropic API Key</label>
        <p class="hint">Your key stays in your browser. Sent only to Anthropic's API.</p>
        <div class="key-row">
          <input type="password" id="key" placeholder="sk-ant-...">
          <a href="https://console.anthropic.com/settings/keys" target="_blank" class="key-link">Get a key</a>
        </div>
      </div>

      <button id="flip-btn">Flip the Tables</button>
      <div id="flip-status"></div>
    </div>

    <!-- Processing View -->
    <div id="processing-view" class="hidden">
      <div class="processing-sigil">&#9672;</div>
      <div id="proc-status">Fetching from the public record...</div>
      <div id="proc-papers"></div>
      <div id="stream-out"></div>
    </div>

    <!-- Results View -->
    <div id="results-view" class="hidden">
      <div id="brief-out" class="brief-box"></div>
      <div class="export-row">
        <button class="export-btn primary" id="dl-brief">Download Brief</button>
        <button class="export-btn" id="dl-tablet">Download Tablet.json</button>
      </div>
      <button id="again-btn">New question</button>
    </div>

    <!-- Settings -->
    <details id="settings">
      <summary>Settings</summary>
      <div class="settings-inner">
        <div class="field">
          <label for="s-key">API Key</label>
          <input type="password" id="s-key">
        </div>
        <div class="field">
          <label for="s-model">Model</label>
          <select id="s-model">
            <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5 (Recommended)</option>
            <option value="claude-opus-4-6">Claude Opus 4.6 (Most Powerful)</option>
          </select>
        </div>
      </div>
    </details>
  </div>

  <script src="js/shoreline.js"></script>
  <script src="js/tablet-press.js"></script>
  <script src="js/synthesis.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
