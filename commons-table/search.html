<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tables Turned — Search</title>
  <meta name="description" content="Search 37 million medical research papers in plain English. AI translates the jargon, you curate the evidence, every claim cites its source.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Crimson+Pro:ital,wght@0,300;0,400;0,500;1,300;1,400&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* ═══ FAST-USE OVERRIDES ═══
       ChatGPT-familiar: centered hero input, value prop as context not obstacle */

    /* Hero section: vertically centered on viewport */
    .fast-hero {
      min-height: 70vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem 1rem;
      animation: fadeIn 0.6s ease;
    }

    .fast-hero .sigil {
      font-size: 1.2rem;
      color: var(--ember);
      letter-spacing: 0.5em;
      margin-bottom: 0.5rem;
      animation: glow 4s ease-in-out infinite;
    }

    .fast-hero h1 {
      font-family: var(--voice);
      font-size: clamp(1.8rem, 5vw, 2.6rem);
      font-weight: 300;
      color: var(--bone);
      letter-spacing: 0.03em;
      margin-bottom: 0.3rem;
    }

    .fast-tagline {
      font-family: var(--voice);
      font-size: clamp(0.95rem, 2.5vw, 1.15rem);
      color: var(--smoke);
      font-style: italic;
      margin-bottom: 2rem;
    }

    /* The main input area */
    .fast-input-box {
      width: 100%;
      max-width: 680px;
      position: relative;
    }

    .fast-input-box textarea {
      width: 100%;
      min-height: 60px;
      max-height: 200px;
      background: var(--card);
      border: 1px solid var(--border-mid);
      color: var(--bone);
      font-family: var(--body);
      font-size: 1.05rem;
      padding: 1rem 1.25rem;
      padding-right: 4.5rem;
      line-height: 1.6;
      resize: none;
      border-radius: 12px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .fast-input-box textarea:focus {
      outline: none;
      border-color: var(--ember);
      box-shadow: 0 0 0 1px rgba(201, 162, 39, 0.15),
                  0 4px 24px rgba(201, 162, 39, 0.06);
    }

    .fast-input-box textarea::placeholder {
      color: var(--smoke);
      font-style: italic;
    }

    .fast-submit-btn {
      position: absolute;
      right: 10px;
      bottom: 10px;
      width: 40px;
      height: 40px;
      border: none;
      background: var(--ember);
      color: var(--void);
      cursor: pointer;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, box-shadow 0.2s;
      font-size: 1.1rem;
    }

    .fast-submit-btn:hover {
      background: var(--ember-glow);
      box-shadow: 0 0 20px rgba(201, 162, 39, 0.3);
    }

    .fast-submit-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .fast-submit-btn:disabled:hover {
      background: var(--ember);
      box-shadow: none;
    }

    .fast-submit-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    /* Context row below the main input */
    .fast-context-row {
      width: 100%;
      max-width: 680px;
      margin-top: 0.75rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .fast-context-row input {
      flex: 1;
      background: var(--card);
      border: 1px solid var(--border-mid);
      color: var(--bone);
      font-family: var(--body);
      font-size: 0.88rem;
      padding: 0.55rem 0.85rem;
      border-radius: 8px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .fast-context-row input:focus {
      outline: none;
      border-color: var(--ember);
      box-shadow: 0 0 0 1px rgba(201, 162, 39, 0.1);
    }

    .fast-context-row input::placeholder {
      color: var(--smoke);
      font-size: 0.82rem;
    }

    .fast-context-label {
      font-family: var(--mono);
      font-size: 0.55rem;
      font-weight: 500;
      color: var(--ember-dim);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      white-space: nowrap;
    }

    /* Suggestion chips */
    .fast-suggestions {
      width: 100%;
      max-width: 680px;
      margin-top: 1.25rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .fast-chip {
      font-family: var(--body);
      font-size: 0.82rem;
      color: var(--bone-dim);
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-mid);
      padding: 0.4rem 0.85rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.25s ease;
      white-space: nowrap;
    }

    .fast-chip:hover {
      border-color: var(--ember-dim);
      color: var(--ember);
      background: rgba(201, 162, 39, 0.04);
    }

    /* Value prop strip below hero */
    .fast-value-strip {
      width: 100%;
      max-width: 680px;
      margin-top: 2.5rem;
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--ash);
    }

    .fast-value-item {
      text-align: center;
      flex: 1;
    }

    .fast-value-icon {
      font-size: 1.1rem;
      color: var(--ember-dim);
      margin-bottom: 0.3rem;
    }

    .fast-value-text {
      font-family: var(--mono);
      font-size: 0.55rem;
      font-weight: 500;
      color: var(--smoke);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      line-height: 1.5;
    }

    /* Status message (below input) */
    .fast-status {
      width: 100%;
      max-width: 680px;
      text-align: center;
      font-family: var(--mono);
      font-size: 0.78rem;
      color: var(--bone-dim);
      min-height: 1.2em;
      margin-top: 0.75rem;
    }
    .fast-status.error { color: var(--red); }

    /* Progress indicator in fast mode */
    .fast-progress {
      width: 100%;
      max-width: 680px;
      margin-top: 1rem;
    }

    /* "Full story" link */
    .fast-full-story {
      margin-top: 1rem;
      font-family: var(--mono);
      font-size: 0.55rem;
      color: var(--smoke);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .fast-full-story a {
      color: var(--ember-dim);
      text-decoration: none;
      border-bottom: 1px solid rgba(139, 115, 85, 0.3);
      transition: color 0.2s, border-color 0.2s;
    }

    .fast-full-story a:hover {
      color: var(--ember);
      border-bottom-color: var(--ember);
    }

    /* Hide the original landing sections' headings since fast mode replaces them */
    .fast-hero #landing-wrap > #whats-this,
    .fast-hero #landing-wrap > #ai-comparison { display: none; }

    /* When the hero collapses after search starts, shrink it */
    .fast-hero.collapsed {
      min-height: auto;
      padding-top: 1.5rem;
      padding-bottom: 0;
    }

    .fast-hero.collapsed h1 { font-size: 1.3rem; margin-bottom: 0.15rem; }
    .fast-hero.collapsed .fast-tagline { margin-bottom: 0; font-size: 0.9rem; }
    .fast-hero.collapsed .fast-suggestions,
    .fast-hero.collapsed .fast-value-strip,
    .fast-hero.collapsed .flow-diagram { display: none; }
    .fast-hero.collapsed .fast-full-story { display: none; }

    /* Override the app container for fast mode */
    body.fast-mode #app {
      max-width: 780px;
    }

    /* Settings toggle in fast mode */
    .fast-settings-toggle {
      width: 100%;
      max-width: 680px;
      margin-top: 0.5rem;
      text-align: right;
    }

    .fast-settings-toggle button {
      background: none;
      border: none;
      font-family: var(--mono);
      font-size: 0.55rem;
      color: var(--smoke);
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.25rem 0;
      transition: color 0.2s;
    }

    .fast-settings-toggle button:hover { color: var(--bone-dim); }

    .fast-settings-panel {
      width: 100%;
      max-width: 680px;
      display: none;
      margin-top: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--ash);
      border-radius: 8px;
    }

    .fast-settings-panel.open { display: block; }

    .fast-settings-panel .settings-grid {
      display: flex;
      gap: 1.5rem;
      align-items: flex-end;
    }

    .fast-settings-panel select {
      border-radius: 6px;
    }

    @media (max-width: 768px) {
      .fast-hero { min-height: 60vh; padding: 1.5rem 1rem; }
      .fast-value-strip { flex-direction: column; gap: 1rem; align-items: center; }
      .fast-context-row { flex-direction: column; }
      .fast-suggestions { gap: 0.4rem; }
      .fast-settings-panel .settings-grid { flex-direction: column; gap: 0.75rem; }
    }
  </style>
</head>
<body class="fast-mode">

  <!-- ═══ NO INTRO — Straight to the app ═══ -->
  <div id="app" class="hidden">

    <!-- ═══ FAST-USE HERO: ChatGPT-familiar centered input ═══ -->
    <div class="fast-hero" id="fast-hero">
      <div class="sigil">&#9674; &#9672; &#9674;</div>
      <h1>Tables Turned</h1>
      <div class="fast-tagline">Read what you paid for.</div>
      <div class="fast-tagline" style="margin-top:-1.5rem; font-size:clamp(0.82rem, 2vw, 0.95rem); font-style:normal; color:var(--smoke);">Search 37 million medical papers in plain English. Every claim cites its source.</div>

      <div class="fast-input-box">
        <textarea id="q" rows="2" placeholder="What health question are you trying to figure out?"></textarea>
        <button class="fast-submit-btn" id="fast-search-btn" title="Search the public record">
          <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>

      <div class="fast-context-row">
        <span class="fast-context-label">Context</span>
        <input type="text" id="ctx" placeholder="What decision does this serve? (optional)">
      </div>

      <div class="fast-status" id="search-status"></div>

      <!-- Progress indicator (hidden until search starts) -->
      <div class="fast-progress">
        <div id="search-progress" class="search-progress hidden">
          <div class="progress-phase" id="prog-phase-1">
            <div class="progress-marker"></div>
            <div class="progress-text">
              <div class="progress-label">Translating your question</div>
              <div class="progress-detail">AI converts plain English into medical search terms</div>
            </div>
          </div>
          <div class="progress-phase" id="prog-phase-2">
            <div class="progress-marker"></div>
            <div class="progress-text">
              <div class="progress-label">Searching PubMed</div>
              <div class="progress-detail">Querying 37 million papers across multiple strategies</div>
            </div>
          </div>
          <div class="progress-phase" id="prog-phase-3">
            <div class="progress-marker"></div>
            <div class="progress-text">
              <div class="progress-label">Fetching papers</div>
              <div class="progress-detail">Pulling titles, authors, and abstracts</div>
            </div>
          </div>
          <div class="progress-phase" id="prog-phase-4">
            <div class="progress-marker"></div>
            <div class="progress-text">
              <div class="progress-label">Translating into plain language</div>
              <div class="progress-detail">Making the jargon readable</div>
            </div>
          </div>
          <div class="edu-scaffold" id="edu-scaffold">
            <div class="edu-scaffold-label">How this is different</div>
            <div class="edu-scaffold-msg" id="edu-scaffold-msg"></div>
          </div>
        </div>
      </div>

      <div class="fast-suggestions" id="fast-suggestions">
        <div class="fast-chip" data-q="Does vitamin D supplementation reduce the frequency or severity of colds and respiratory infections?" data-ctx="Deciding whether to take vitamin D supplements this winter">Vitamin D &amp; colds</div>
        <div class="fast-chip" data-q="Is there a link between childhood vaccines and autism spectrum disorder?" data-ctx="New parent evaluating the vaccination schedule">Vaccines &amp; autism</div>
        <div class="fast-chip" data-q="Does consumption of ultra-processed foods increase cancer risk?" data-ctx="Trying to make better grocery decisions for my family">Processed foods &amp; cancer</div>
        <div class="fast-chip" data-q="What are the health effects of vaping cannabis compared to smoking it?" data-ctx="Considering switching from smoking to vaping">Vaping cannabis</div>
        <div class="fast-chip" data-q="How effective is semaglutide (Ozempic) for weight loss and what are the risks?" data-ctx="Considering asking my doctor about Ozempic">Ozempic &amp; weight loss</div>
      </div>

      <div class="fast-settings-toggle" id="fast-settings-toggle">
        <button id="toggle-settings-btn">&#9881; Settings</button>
      </div>

      <div class="fast-settings-panel" id="fast-settings-panel">
        <div class="settings-grid">
          <div class="setting-item">
            <label for="s-depth">Results per query</label>
            <select id="s-depth">
              <option value="5" selected>5 (quick scan)</option>
              <option value="10">10 (standard)</option>
              <option value="25">25 (deep dive)</option>
            </select>
          </div>
          <div class="setting-item">
            <label for="s-sort">Sort by</label>
            <select id="s-sort">
              <option value="relevance" selected>Most relevant</option>
              <option value="pub_date">Most recent</option>
            </select>
          </div>
        </div>
      </div>

      <div class="flow-diagram" style="max-width:680px; margin:2rem auto 0.5rem;">
        <div class="flow-step">
          <div class="flow-icon">?</div>
          <div class="flow-label">You ask</div>
          <div class="flow-detail">plain English</div>
        </div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step">
          <div class="flow-icon">&#9906;</div>
          <div class="flow-label">AI searches</div>
          <div class="flow-detail">PubMed &middot; 37M papers</div>
        </div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step">
          <div class="flow-icon">&#10003;</div>
          <div class="flow-label">You choose</div>
          <div class="flow-detail">which papers matter</div>
        </div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step">
          <div class="flow-icon">&#9671;</div>
          <div class="flow-label">AI reads</div>
          <div class="flow-detail">the abstracts</div>
        </div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step flow-step-accent">
          <div class="flow-icon">&#9758;</div>
          <div class="flow-label">Your brief</div>
          <div class="flow-detail">every claim cited</div>
        </div>
      </div>

      <div class="fast-full-story">
        <a href="#" id="open-about-modal">The full story &rarr;</a>
      </div>
    </div>

    <!-- ═══ STEP 2: CURATE (same as original) ═══ -->
    <div id="curate-view" class="hidden">
      <div class="step-label">Step 2 <span class="step-label-text">Choose your papers</span></div>
      <p class="step-desc">AI translated your question into the medical jargon the system was built on &mdash; then translated the results back into plain language. Select the papers that matter to your question. Deselect the rest.</p>

      <details class="search-disclosure" id="search-disclosure">
        <summary>How we found these papers</summary>
        <div class="search-evolution">
          <div class="search-evolution-step">
            <div class="evolution-label">Your question</div>
            <div class="evolution-content" id="evolution-question"></div>
          </div>
          <div class="evolution-arrow">&darr;</div>
          <div class="search-evolution-step">
            <div class="evolution-label">AI translated it into</div>
            <div id="search-terms-display"></div>
          </div>
          <div class="evolution-arrow">&darr;</div>
          <div class="search-evolution-step">
            <div class="evolution-label">Results</div>
            <div class="evolution-content" id="search-stats"></div>
          </div>
        </div>
        <div class="prompt-peek">
          <details>
            <summary>See the full search prompt</summary>
            <pre id="search-prompt-display" class="prompt-display"></pre>
          </details>
        </div>
      </details>

      <div class="curate-actions">
        <button id="select-all-btn" class="btn-small">Select all</button>
        <button id="select-none-btn" class="btn-small">Select none</button>
        <span id="curate-count" class="curate-count"></span>
      </div>

      <div id="curate-list"></div>

      <button id="synthesize-btn" class="btn-primary">Read and Synthesize</button>
      <button id="back-to-search" class="btn-back">&#8592; Back to search</button>
    </div>

    <!-- ═══ STEP 3: PROCESSING (same as original) ═══ -->
    <div id="processing-view" class="hidden">
      <div class="step-label">Step 3 <span class="step-label-text">Reading the record</span></div>
      <div class="processing-sigil">&#9672;</div>
      <div id="proc-status">Preparing synthesis...</div>
      <div id="proc-papers"></div>

      <details class="prompt-peek">
        <summary>See the synthesis prompt</summary>
        <pre id="synth-prompt-display" class="prompt-display"></pre>
      </details>

      <div id="stream-out"></div>
      <div class="stream-notice" id="stream-notice">Your <strong>formatted brief</strong> is being prepared. The text above is the raw AI output streaming in real time &mdash; your final report will be cleanly structured with headings, citations, and a downloadable document.</div>
    </div>

    <!-- ═══ STEP 4: RESULTS (same as original) ═══ -->
    <div id="results-view" class="hidden">
      <div class="step-label">Your Brief</div>
      <div id="brief-out" class="brief-box"></div>

      <details class="prompt-peek" style="margin-bottom: 1rem;">
        <summary>See the prompt that generated this brief</summary>
        <pre id="result-prompt-display" class="prompt-display"></pre>
      </details>

      <div class="provenance-section" id="provenance-section">
        <details>
          <summary>Provenance log</summary>
          <div id="provenance-log" class="provenance-log"></div>
        </details>
      </div>

      <div class="export-section">
        <div class="export-heading">Take it with you</div>
        <div class="export-row">
          <div class="export-option">
            <button class="export-btn primary" id="dl-docx">Download Brief (.docx)</button>
            <p class="export-hint">Your brief as a Word document. Share it with your doctor, print it, or keep it for reference. Every claim cites its source.</p>
          </div>
          <div class="export-option">
            <button class="export-btn" id="dl-brief">Download Brief (.md)</button>
            <p class="export-hint">Plain text with formatting. Opens in any text editor. Good for pasting into notes or emails.</p>
          </div>
          <div class="export-option">
            <button class="export-btn" id="dl-tablet">Download Tablet (.json)</button>
            <p class="export-hint">The full session &mdash; your question, every paper, search terms, prompts, and the brief &mdash; in a structured data file. For archiving or re-analysis.</p>
          </div>
        </div>
      </div>
      <button id="again-btn" class="btn-back">&#8592; New question</button>
    </div>

    <!-- ═══ ABOUT MODAL ═══ -->
    <div class="about-modal-overlay" id="about-modal-overlay">
      <div class="about-modal">
        <button class="about-modal-close" id="about-modal-close">Close &times;</button>

        <div class="doc-chapter">
          <h2>Why This Exists</h2>
          <p>Your taxes funded 37 million medical research papers. Then private publishers locked them behind <strong>$35 paywalls</strong>. And the ones you can reach? Written in jargon designed to keep you out.</p>
          <p><strong>Paywall:</strong> &ldquo;You can&rsquo;t read it.&rdquo; <strong>Credential wall:</strong> &ldquo;You won&rsquo;t understand it.&rdquo;</p>
          <p>Tables Turned breaks both. Ask a question in plain English. AI searches the real U.S. medical database, translates the jargon, and writes a brief where <strong>every claim cites a source you can click and verify</strong>. You choose which papers matter. Nothing is hidden.</p>
        </div>

        <div class="doc-chapter">
          <h2>Why Not Just Ask ChatGPT?</h2>
          <p>These tools treat you as a <strong>consumer of answers</strong>. You ask. They deliver. You accept. Sound familiar?</p>
          <p>It is the same gatekeeping pattern wearing a friendlier mask. The journals said: trust us, we curate the knowledge. The algorithms say: trust us, we summarize it. In both cases, the evidence is not in your hands.</p>
          <p>Tables Turned takes a different position: you should be in <strong>dialogue with the evidence itself</strong>. Not receiving a verdict. Not consuming a summary. Sitting at the table, choosing which papers matter, reading what they actually say, and walking away with every claim traced to its source.</p>
        </div>

        <div class="doc-chapter">
          <h2>The Dialogue</h2>
          <h3>Step 1: You ask a question</h3>
          <p>Type your question in plain English. Add your decision context &mdash; the reason you are asking. The context shapes which evidence matters most.</p>
          <h3>Step 2: AI translates your question into PubMed&rsquo;s language</h3>
          <p>Your question is sent to Claude, which generates <strong>multiple search strategies</strong> using real medical terminology. You can see every search term it generated, and why.</p>
          <h3>Step 3: Papers come back in plain language</h3>
          <p>Papers return with titles, authors, journals, and abstracts. AI translates each into plain language. <strong>You decide which papers to include.</strong></p>
          <h3>Step 4: AI reads and writes your brief</h3>
          <p>The papers you selected are synthesized with strict instructions: cite every claim, surface contradictions, state confidence honestly. You leave with receipts.</p>
        </div>

        <div class="doc-chapter">
          <h2>Honest Limits</h2>
          <ul>
            <li><strong>Abstracts only.</strong> Tables Turned reads abstracts, not full papers. If a paper matters, find and read the full text.</li>
            <li><strong>AI can err.</strong> Every claim includes a PMID &mdash; click it and verify.</li>
            <li><strong>Not medical advice.</strong> This gives you better questions to ask your doctor, not answers to follow blindly.</li>
          </ul>
        </div>

        <div class="doc-chapter">
          <h2>Technical Details</h2>
          <p><strong>Data source:</strong> PubMed / NCBI E-utilities &mdash; the same database used by researchers worldwide.</p>
          <p><strong>AI model:</strong> Claude by Anthropic. Your requests route through a minimal Cloudflare Worker proxy. No data is logged or stored.</p>
          <p><strong>Privacy:</strong> Your briefs exist only in your browser. No tracking. No analytics. No database.</p>
        </div>

        <div class="doc-chapter">
          <h2>The Lineage</h2>
          <p>Tables Turned inherits from a long tradition of putting knowledge back in common hands &mdash; from Tyndale&rsquo;s translation to Carnegie&rsquo;s libraries to Aaron Swartz&rsquo;s fight for open access.</p>
          <p class="lineage-end">The tables have turned. Take your seat.</p>
        </div>

      </div>
    </div>

    <!-- ═══ FOOTER ═══ -->
    <footer id="site-footer">
      <div class="footer-brand">
        <div class="footer-sigil">&#9674; &#9672; &#9674;</div>
        <div class="footer-title">The Word Against The Flood</div>
      </div>
      <div class="footer-links">
        <a href="mailto:JEThomasPhD@gmail.com">JEThomasPhD@gmail.com</a>
      </div>
      <div class="footer-sig">
        Made using <a href="https://the-companion-dossier.pages.dev/Latent_Dialogic_Space/" target="_blank" rel="noopener">Latent Dialogic Space</a>
      </div>
    </footer>
  </div>

  <script src="js/shoreline.js"></script>
  <script src="js/tablet-press.js"></script>
  <script src="js/synthesis.js"></script>
  <script src="js/app.js"></script>
  <script>
    // ═══ FAST-USE WIRING ═══
    (() => {
      const $ = id => document.getElementById(id);
      const hero = $('fast-hero');
      const qEl = $('q');
      const ctxEl = $('ctx');
      const searchBtn = $('fast-search-btn');

      // Suggestion chips fill the inputs
      document.querySelectorAll('.fast-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          qEl.value = chip.dataset.q;
          ctxEl.value = chip.dataset.ctx || '';
          qEl.focus();
          qEl.style.height = 'auto';
          qEl.style.height = qEl.scrollHeight + 'px';
        });
      });

      // Settings toggle
      $('toggle-settings-btn').addEventListener('click', () => {
        $('fast-settings-panel').classList.toggle('open');
      });

      // Search button and Enter key both trigger the pipeline
      searchBtn.addEventListener('click', triggerSearch);
      qEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          triggerSearch();
        }
      });

      // Auto-resize textarea as user types
      qEl.addEventListener('input', () => {
        qEl.style.height = 'auto';
        qEl.style.height = Math.min(qEl.scrollHeight, 200) + 'px';
      });

      function triggerSearch() {
        const question = (qEl.value || '').trim();
        if (!question) {
          $('search-status').textContent = 'Ask a question first.';
          $('search-status').className = 'fast-status error';
          return;
        }
        hero.classList.add('collapsed');
        searchBtn.disabled = true;
        startEduScaffold();
        window.dispatchEvent(new CustomEvent('tables-turned-search'));
      }

      // Re-enable the button when navigating back
      window.addEventListener('tables-turned-reset', () => {
        searchBtn.disabled = false;
        stopEduScaffold();
      });

      // ── About Modal ──
      const modalOverlay = $('about-modal-overlay');
      $('open-about-modal').addEventListener('click', (e) => {
        e.preventDefault();
        modalOverlay.classList.add('open');
      });
      $('about-modal-close').addEventListener('click', () => {
        modalOverlay.classList.remove('open');
      });
      modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) modalOverlay.classList.remove('open');
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalOverlay.classList.contains('open')) {
          modalOverlay.classList.remove('open');
        }
      });

      // ── Educational Scaffolding ──
      const EDU_MESSAGES = [
        'Google AI Overviews summarizes blogs, forums, and ads \u2014 weighted the same as peer-reviewed research. This searches the actual U.S. medical database.',
        'ChatGPT fabricates citations \u2014 invented authors, fake titles, delivered with confidence. Here, every paper is real and every PMID is clickable.',
        'Other tools give you answers. This gives you evidence \u2014 and lets you decide which papers matter.',
        'Every claim in your brief will link to a real PubMed paper you can verify in 3 seconds.',
        'Your taxes funded this research. The abstracts are public. AI just broke the jargon barrier for you.',
        'Unlike a search engine, this tool shows you exactly which search terms the AI used \u2014 and lets you see every prompt.'
      ];
      let eduInterval = null;
      let eduIdx = 0;

      function startEduScaffold() {
        const msgEl = $('edu-scaffold-msg');
        if (!msgEl) return;
        eduIdx = 0;
        msgEl.textContent = EDU_MESSAGES[0];
        eduInterval = setInterval(() => {
          eduIdx = (eduIdx + 1) % EDU_MESSAGES.length;
          msgEl.style.opacity = '0';
          setTimeout(() => {
            msgEl.textContent = EDU_MESSAGES[eduIdx];
            msgEl.style.opacity = '1';
          }, 400);
        }, 5000);
      }

      function stopEduScaffold() {
        if (eduInterval) { clearInterval(eduInterval); eduInterval = null; }
      }
    })();
  </script>
</body>
</html>
